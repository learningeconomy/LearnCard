const n={},g=r=>{const a=new Map,o=t=>{if(t.url)return`url:${t.url}`;try{return`raw:${JSON.stringify(t.raw)}`}catch{return`raw:${String(t.title??"")}`}};for(const t of r){const e=o(t);a.has(e)||a.set(e,t)}return Array.from(a.values())},b=r=>new Promise(a=>{chrome.storage.local.get(r,o=>a(o))}),m=r=>new Promise(a=>{chrome.storage.local.set(r,()=>a())});chrome.runtime.onInstalled.addListener(()=>{chrome.action.setBadgeText({text:""})});chrome.runtime.onMessage.addListener((r,a,o)=>{switch(r.type){case"credential-detected":{const t=a.tab?.id;typeof t=="number"?(n[t]=[r.payload],chrome.action.setBadgeText({text:"1",tabId:t})):(n[-1]=[r.payload],chrome.action.setBadgeText({text:"1"})),o({ok:!0});return}case"credentials-detected":{const t=r,e=(typeof t.tabId=="number"?t.tabId:a.tab?.id)??-1,c=t.payload??[],d=typeof t.tabId=="number",i=n[e]??[],s=d?g([...i,...c]):c;n[e]=s,typeof e=="number"?chrome.action.setBadgeText({text:s.length?String(s.length):"",tabId:e}):chrome.action.setBadgeText({text:s.length?String(s.length):""}),o({ok:!0});return}case"get-detected":{const t=r,e=(typeof t.tabId=="number"?t.tabId:a.tab?.id)??-1,c=n[e]??[];o({ok:!0,data:c});return}case"save-credential":return(async()=>{try{const t=r,e=(typeof t.tabId=="number"?t.tabId:a.tab?.id)??-1,c=(n[e]??[])[0]??null,{savedCredentials:d}=await b({savedCredentials:[]}),i=c?[...d,{...c,savedAt:Date.now()}]:d;await m({savedCredentials:i});const l=(n[e]??[]).slice(1);n[e]=l;const u=l.length?String(l.length):"";typeof e=="number"&&a.tab?.id===e?chrome.action.setBadgeText({text:u,tabId:e}):chrome.action.setBadgeText({text:u}),o({ok:!0})}catch(t){console.error("Failed to save credential",t),o({ok:!1,error:t.message})}})(),!0}});
//# sourceMappingURL=main.ts-CFEwFy1K.js.map
