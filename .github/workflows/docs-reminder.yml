name: Documentation Reminder

on:
    pull_request:
        types: [opened, synchronize]

jobs:
    check-docs:
        runs-on: ubuntu-latest
        permissions:
            pull-requests: write

        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Detect file changes
              uses: dorny/paths-filter@v3
              id: filter
              with:
                  filters: |
                      code:
                        - 'services/**'
                        - 'packages/**'
                        - 'apps/**'
                      docs:
                        - 'docs/**'

            - name: Remind about documentation
              if: steps.filter.outputs.code == 'true' && steps.filter.outputs.docs == 'false'
              uses: actions/github-script@v7
              with:
                  script: |
                      const body = `ðŸ‘‹ **Hey there!** It looks like you modified code, but didn't update the documentation in \`/docs\`.

                      If this PR introduces new features, changes APIs, or modifies behavior that users or developers need to know about, please consider updating the docs.

                      ---

                      ### ðŸ„ Windsurf Tip

                      You can ask Windsurf to help:

                      > **"Analyze the changes in this PR and update the gitbook docs in /docs accordingly."**

                      Windsurf will review your changes and suggest appropriate documentation updates based on what was modified.

                      ---

                      <details>
                      <summary>ðŸ“š Documentation Guide</summary>

                      | Change Type | Doc Location |
                      |-------------|--------------|
                      | New feature/API | \`docs/tutorials/\` or \`docs/how-to-guides/\` |
                      | SDK/API changes | \`docs/sdks/\` |
                      | New concepts | \`docs/core-concepts/\` |
                      | App UI/UX flows | \`docs/apps/\` (LearnCard App, ScoutPass) |
                      | Internal patterns | \`AGENTS.md\` |

                      </details>

                      *This is an automated reminder. If no docs are needed, feel free to ignore this message.*`;

                      // Check if we already commented to avoid duplicates
                      const { data: comments } = await github.rest.issues.listComments({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: context.issue.number,
                      });

                      const botComment = comments.find(comment => 
                        comment.user.type === 'Bot' && 
                        comment.body.includes('didn\'t update the documentation in `/docs`')
                      );

                      if (!botComment) {
                        await github.rest.issues.createComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: context.issue.number,
                          body: body
                        });
                      }
