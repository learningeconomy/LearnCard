{"version":3,"file":"MetricCollector.js","sourceRoot":"","sources":["../../../src/state/MetricCollector.ts"],"names":[],"mappings":"AAAA;;;;;;;;;;;;;;GAcG;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEH,OAAO,EAAE,MAAM,EAAE,MAAM,qBAAqB,CAAC;AAQ7C;;;;GAIG;AACH;IAEE,yBAAoB,YAAsC,EAAU,aAA2B;QAA3E,iBAAY,GAAZ,YAAY,CAA0B;QAAU,kBAAa,GAAb,aAAa,CAAc;QAC7F,IAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC,aAAa,CAAC,kCAAkC,EAAE,CAAC;IACvF,CAAC;IAEK,iCAAO,GAAb;;;;;;;wBACQ,cAAc,GAAG,MAAM,EAAE,CAAC;wBAC1B,uBAAuB,GAAG,KAAK,CAAC,IAAI,CAAC,IAAI,CAAC,YAAY,CAAC,iBAAiB,CAAC,MAAM,EAAE,CAAC;6BACrF,GAAG,CAAC,UAAA,gBAAgB,IAAI,OAAA,gBAAgB,CAAC,OAAO,CAAC,KAAI,EAAE,cAAc,CAAC,EAA9C,CAA8C,CAAC,CAAC;wBACrC,qBAAM,OAAO,CAAC,GAAG,CAAC,uBAAuB,CAAC,EAAA;;wBAA1E,6BAA6B,GAAG,SAA0C;wBAEhF,sBAAO;gCACL,QAAQ,EAAE,IAAI,CAAC,YAAY,CAAC,QAAQ;gCACpC,6BAA6B,+BAAA;6BAC9B,EAAC;;;;KACH;IAED;;OAEG;IACG,oCAAU,GAAhB,UAAiB,OAA2B;;;;4BAC1C,qBAAM,IAAI,CAAC,aAAa,CAAC,UAAU,CAAC,OAAO,CAAC,EAAA;;wBAA5C,SAA4C,CAAC;;;;;KAC9C;IAED;;OAEG;IACG,kCAAQ,GAAd,UAAe,OAAyB;;;;4BACtC,qBAAM,IAAI,CAAC,aAAa,CAAC,QAAQ,CAAC,OAAO,CAAC,EAAA;;wBAA1C,SAA0C,CAAC;;;;;KAC5C;IACH,sBAAC;AAAD,CAAC,AA/BD,IA+BC","sourcesContent":["/*\n * Copyright The OpenTelemetry Authors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *      https://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { hrTime } from '@opentelemetry/core';\nimport { AggregationTemporality } from '../export/AggregationTemporality';\nimport { ResourceMetrics } from '../export/MetricData';\nimport { MetricProducer } from '../export/MetricProducer';\nimport { MetricReader } from '../export/MetricReader';\nimport { ForceFlushOptions, ShutdownOptions } from '../types';\nimport { MeterProviderSharedState } from './MeterProviderSharedState';\n\n/**\n * An internal opaque interface that the MetricReader receives as\n * MetricProducer. It acts as the storage key to the internal metric stream\n * state for each MetricReader.\n */\nexport class MetricCollector implements MetricProducer {\n  public readonly aggregatorTemporality: AggregationTemporality;\n  constructor(private _sharedState: MeterProviderSharedState, private _metricReader: MetricReader) {\n    this.aggregatorTemporality = this._metricReader.getPreferredAggregationTemporality();\n  }\n\n  async collect(): Promise<ResourceMetrics> {\n    const collectionTime = hrTime();\n    const meterCollectionPromises = Array.from(this._sharedState.meterSharedStates.values())\n      .map(meterSharedState => meterSharedState.collect(this, collectionTime));\n    const instrumentationLibraryMetrics = await Promise.all(meterCollectionPromises);\n\n    return {\n      resource: this._sharedState.resource,\n      instrumentationLibraryMetrics,\n    };\n  }\n\n  /**\n   * Delegates for MetricReader.forceFlush.\n   */\n  async forceFlush(options?: ForceFlushOptions): Promise<void> {\n    await this._metricReader.forceFlush(options);\n  }\n\n  /**\n   * Delegates for MetricReader.shutdown.\n   */\n  async shutdown(options?: ShutdownOptions): Promise<void> {\n    await this._metricReader.shutdown(options);\n  }\n}\n\n/**\n * An internal interface for MetricCollector. Exposes the necessary\n * information for metric collection.\n */\nexport interface MetricCollectorHandle {\n  aggregatorTemporality: AggregationTemporality;\n}\n"]}